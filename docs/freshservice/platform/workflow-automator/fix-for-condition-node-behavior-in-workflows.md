# 워크플로우에서 조건 노드 동작 수정사항

이 문서에서는 워크플로우에서 조건 노드가 승인 상태를 평가하는 방식을 개선하는 향상된 기능에 대해 설명합니다.

## 수정사항 개요

조건 노드에서 승인 상태를 처리하는 방식이 개선되어 더욱 정확하고 일관된 워크플로우 실행이 가능해졌습니다.

## 이전 동작의 문제점

기존 조건 노드에서는 승인 상태 평가 시 다음과 같은 문제가 있었습니다:

- 승인 상태 변경이 즉시 반영되지 않는 경우
- 복합 승인 시나리오에서 불일치 발생
- 승인 워크플로우의 중간 상태 처리 오류

## 개선된 기능

### 1. 실시간 승인 상태 동기화
- 승인 상태 변경이 즉시 조건 노드에 반영됩니다
- 승인자의 응답이 실시간으로 워크플로우에 적용됩니다
- 승인 상태의 지연 업데이트 문제가 해결되었습니다

### 2. 향상된 승인 상태 인식
조건 노드가 인식하는 승인 상태가 확장되었습니다:

**기본 상태:**
- `승인됨` (Approved)
- `거부됨` (Rejected)
- `대기 중` (Pending)

**확장 상태:**
- `부분 승인됨` (Partially Approved)
- `승인 취소됨` (Approval Cancelled)
- `승인 만료됨` (Approval Expired)
- `승인 재요청됨` (Re-approval Requested)

### 3. 복합 승인 시나리오 지원
- 다단계 승인 프로세스에서 각 단계별 상태 추적
- 병렬 승인에서 부분 승인 상태 처리
- 조건부 승인 시나리오에 대한 향상된 로직

## 실제 사용 예시

### 예시 1: 다단계 승인 워크플로우
```
조건: 승인 상태가 "1차 승인됨"인 경우
→ YES: 2차 승인자에게 요청 전송
→ NO: 1차 승인 대기 또는 승인 요청 재전송
```

### 예시 2: 병렬 승인 처리
```
조건: 모든 필수 승인자가 승인한 경우
→ YES: 최종 승인 완료 처리
→ NO: 대기 중인 승인자에게 리마인더 발송
```

### 예시 3: 조건부 승인
```
조건: 예산 승인이 완료되고 AND 기술 검토가 승인된 경우
→ YES: 프로젝트 시작 액션 실행
→ NO: 추가 승인 요청 또는 대기
```

## 설정 방법

### 1. 조건 노드에서 승인 상태 사용
1. 워크플로우에서 조건 노드를 추가합니다
2. 조건 유형을 "승인 상태"로 선택합니다
3. 확인하고자 하는 승인 상태를 선택합니다
4. 필요한 경우 복합 조건을 설정합니다

### 2. 승인 상태 조합 사용
```
조건 1: 승인 상태  = "승인됨"
AND
조건 2: 승인자  = "특정 역할"
```

### 3. 시간 기반 승인 체크
```
조건: 승인 요청 후 72시간이 경과 AND 승인 상태  = "대기 중"
→ YES: 에스컬레이션 프로세스 시작
```

## 모범 사례

### 1. 승인 상태 체크 주기
- 실시간 처리가 필요한 경우: 즉시 체크
- 일반적인 경우: 15분 간격으로 체크
- 비긴급 프로세스: 1시간 간격으로 체크

### 2. 복합 승인 처리
- 각 승인 단계별로 별도의 조건 노드 사용
- 승인 상태 변경 시 즉시 다음 단계로 진행
- 승인 실패 시 적절한 에러 처리 로직 구현

### 3. 승인 타임아웃 처리
- 승인 요청 후 일정 시간 경과 시 자동 에스컬레이션
- 만료된 승인에 대한 자동 재요청 메커니즘
- 승인자 부재 시 대체 승인자 지정

## 주의사항

1. **기존 워크플로우 영향**: 기존에 승인 상태를 사용하는 워크플로우의 동작이 변경될 수 있습니다.

2. **테스트 필요**: 승인 관련 워크플로우는 개선 후 반드시 테스트해야 합니다.

3. **권한 확인**: 승인 상태를 확인하는 사용자가 적절한 권한을 가지고 있는지 확인하세요.

4. **성능 고려**: 실시간 승인 상태 체크는 시스템 성능에 영향을 줄 수 있으므로 적절한 주기로 설정하세요.

이러한 개선사항으로 승인 워크플로우의 정확성과 안정성이 크게 향상되었습니다.